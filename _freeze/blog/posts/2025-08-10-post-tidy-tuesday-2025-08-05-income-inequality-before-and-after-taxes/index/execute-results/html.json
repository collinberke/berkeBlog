{
  "hash": "fc619511fb173cec505e48bb53904c1d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"TidyTueday contribution: 2028-08-05\"\ndescription: \"Income Inequality Before and After Taxes\"\ndate: \"2025-08-10\"\nauthor: \"Collin K. Berke, Ph.D.\"\ndraft: false\nimage: thumbnail.jpg\ntoc: true\ncode-link: true\ncode-copy: true\nfrom: markdown+emoji\ncategories:\n  - data visualization\n  - tidytuesday\n---\n\n\n\n![Photo by [Martin Sanchez](https://unsplash.com/photos/red-and-black-abstract-art-j2c7yf223Mk)](thumbnail-wide.jpg)\n\n# Background\n\n[This week's TidyTuesday](https://github.com/rfordatascience/tidytuesday/blob/main/data/2025/2025-08-05/readme.md) included data exploring Income Inequality Before and After Taxes.\nThe article [\"Income inequality before and after taxes: how much do countries redistribute income?\"](https://ourworldindata.org/income-inequality-before-and-after-taxes) by Joe Hasell inspired this week's data.\nThe data were processed by [Our World in Data](https://ourworldindata.org), and they orignated from various sources (see the [documentation](https://github.com/rfordatascience/tidytuesday/blob/main/data/2025/2025-08-05/readme.md) for more info).\n\nThe data provides an estimate called the Gini coefficient for both before and after taxes.\nHere's the definition:\n\n> The Gini coefficient measures inequality on a scale from 0 to 1. Higher values indicate higher inequality.\n> Inequality is measured here in terms of income before and after taxes and benefits.\n\n# My contribution\n\nHere is my contribution for the week of 2025-08-05:\n\n![](vis-income-inequality-dumbell.gif){width=500 height=500 fig-align=\"center\"}\n\nThe code I used to produce this animated plot follows.\n\nYou can also access the code via my TidyTuesday GitHub repository [here](https://github.com/collinberke/berkeTidyTuesday).\n\n[Here](https://github.com/collinberke/berkeTidyTuesday/blob/main/2025/2025-08-05/2025-08-05.R) is the code for this specific contribution.\n\nIf you like what you see or want to discuss this week's contribution, follow and connect with me in these places:\n\n* BlueSky: [collinberke.bsky.social](https://bsky.app/profile/collinberke.bsky.social)\n* GitHub: [collinberke](https://github.com/collinberke)\n* LinkedIn: [@collinberke](https://www.linkedin.com/in/collinberke/)\n\n# The code\n\n\n\n::: {.cell warnings='false'}\n\n```{.r .cell-code}\n# Setup -----\n\nlibrary(tidyverse)\nlibrary(tidytuesdayR)\nlibrary(berkeBrand)\nlibrary(here)\nlibrary(glue)\nlibrary(skimr)\nlibrary(janitor)\nlibrary(ggalt)\nlibrary(ggtext)\nlibrary(gganimate)\n\n# Get data -----\n\n# `gini_mi_eq` = pre-tax inequality\n# `gini_dhi_eq` = post-tax inequality\n\n# data-import-income-inequality\ntuesdaydata <- tt_load('2025-08-05')\n\nincome_inequality_processed <-\n  tuesdaydata$income_inequality_processed |>\n  clean_names()\n\n# Explore data -----\n\n# data-explore\nnames(income_inequality_processed)\nglimpse(income_inequality_processed)\nskim(income_inequality_processed)\n\n# Questions to explore:\n#   * How many countries are represented in the data?\n#   * How many data points (i.e., years) are available for each country?\n#   * Range of data points per country?\n#   * Over what years does this data represent?\n\n# data-questions\n\n# Countries?\nincome_inequality_processed |>\n  distinct(entity) |>\n  count()\n\n# Data points?\ndata_points <- income_inequality_processed |>\n  group_by(entity) |>\n  count(sort = TRUE) |>\n  print(n = 100)\n\n# Per country?\nrange(data_points$n)\n\n# What country(s) only has one?\n# The Dominican Republic\ndata_points |> filter(n == 1)\n\n# Years represented?\n# 1963 to 2023 for some countries, not all\nrange(income_inequality_processed$year)\n\n# Transform data -----\n\n# trnsfm-inequality-data\ndata_income_inequality <- income_inequality_processed |>\n  arrange(entity, year) |>\n  complete(entity, year = 1963:2023) |>\n  group_by(entity) |>\n  fill(gini_mi_eq, gini_dhi_eq) |>\n  mutate(diff = gini_mi_eq - gini_dhi_eq)\n\n## An animated dumbell chart -----\n\n# plot-text\n\ntitle <- \"<strong>Income inequality before and after taxes</strong>\"\nsubtitle <- \"{closest_state} Gini coefficient: a measure of income inequality\"\ncaption <- glue(\n  \"<br>\",\n  add_tt(\n    source = \"Processed from multiple sources by Our World in Data\",\n    tt_date = \"2025-08-05\"\n  ),\n  \"<br>\",\n  \"<strong>Note:</strong> Countries ordered by maxmimum Gini coefficient after taxes, values forward filled\",\n  \"<br>\",\n  add_socials()\n)\nx <- glue(\n  \"Gini coefficient\",\n  \"(<span style = 'color: orange;'><strong>before</strong></span>\",\n  \"and <span style = 'color: blue;'><strong>after taxes</strong></span>)\",\n  .sep = \" \"\n)\ny <- \"\"\n\n## Static chart -----\n\n# I found this useful because the rendering of the animation can take some time.\n# Having this static plot allowed for faster iteration.\n\n# vis-dumbell-chart-ggplot2\nvis_income_inequality <- ggplot(\n  data = data_income_inequality\n) +\n  geom_segment(\n    aes(\n      x = gini_mi_eq,\n      xend = gini_dhi_eq,\n      y = reorder(entity, gini_dhi_eq, max, na.rm = TRUE),\n      yend = reorder(entity, gini_dhi_eq, max, na.rm = TRUE)\n    ),\n    color = \"darkgrey\",\n    linewidth = .5\n  ) +\n  geom_point(\n    aes(x = gini_mi_eq, y = reorder(entity, gini_dhi_eq, max, na.rm = TRUE)),\n    size = 2,\n    fill = \"black\",\n    shape = 24\n  ) +\n  geom_point(\n    aes(x = gini_mi_eq, y = reorder(entity, gini_dhi_eq, max, na.rm = TRUE)),\n    size = 1,\n    fill = \"orange\",\n    shape = 24\n  ) +\n  geom_point(\n    aes(x = gini_dhi_eq, y = reorder(entity, gini_dhi_eq, max, na.rm = TRUE)),\n    size = 2,\n    fill = \"black\",\n    shape = 24\n  ) +\n  geom_point(\n    aes(x = gini_dhi_eq, y = reorder(entity, gini_dhi_eq, max, na.rm = TRUE)),\n    size = 1,\n    fill = \"blue\",\n    shape = 24\n  ) +\n  theme_minimal() +\n  labs(\n    title = title,\n    subtitle = subtitle,\n    caption = caption,\n    y = \"\",\n    x = x\n  ) +\n  theme(\n    plot.title = element_textbox_simple(size = 20),\n    plot.subtitle = element_text(size = 16, hjust = 0),\n    plot.caption = element_textbox_simple(halign = 1, vjust = -5),\n    panel.grid.minor = element_blank(),\n    panel.grid.major.y = element_blank(),\n    axis.text.y = element_text(size = 7, color = \"black\"),\n    axis.text.x = element_text(color = \"black\"),\n    axis.title.x = element_textbox_simple(halign = .5)\n  )\n\nggsave(\n  here(\n    \"blog/posts/\",\n    \"2025-08-10-post-tidy-tuesday-2025-08-05-income-inequality-before-and-after-taxes\",\n    \"vis-income-inequality-dumbell.png\"\n  )\n)\n\n# func-get-dumbell-chart\nget_dumbell_chart <- function() {\n  vis_income_inequality\n}\n\n# vis-animation-transitions\ntimelapse_income_inequality_dumbell <- get_dumbell_chart() +\n  transition_states(year, transition_length = 3, state_length = 5) +\n  ease_aes(\"quadratic-in-out\", interval = 1)\n\n# vis-animate-visualization\nanimated_income_inequality_plot <- animate(\n  timelapse_income_inequality_dumbell,\n  nframes = 125,\n  duration = 45,\n  start_pause = 5,\n  end_pause = 5,\n  height = 7,\n  width = 7,\n  res = 150,\n  units = \"in\",\n  fps = 10,\n  renderer = gifski_renderer(loop = TRUE)\n)\n\nanim_save(\n  here(\n    \"blog/posts/\",\n    \"2025-08-10-post-tidy-tuesday-2025-08-05-income-inequality-before-and-after-taxes\",\n    \"vis-income-inequality-dumbell.gif\"\n  ),\n  animated_income_inequality_plot\n)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}