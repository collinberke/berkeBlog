<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Collin K. Berke, Ph.D.">
<meta name="dcterms.date" content="2023-10-22">
<meta name="description" content="Use the corrr package to calculate and visualize correlations">

<title>TIL: Calculating correlations with corrr – Collin K. Berke, Ph.D.</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../icon.png" rel="icon" type="image/png">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-d1b12f2568ecbe55642fee6aa00bd082.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-a8e159b6550ef0b122714fdf25f42c03.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Collin K. Berke, Ph.D.</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../now.html"> 
<span class="menu-text">Now</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../say-hi.html"> 
<span class="menu-text">Say Hi!</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-data" id="toc-the-data" class="nav-link active" data-scroll-target="#the-data">The data</a></li>
  <li><a href="#calculate-correlations-with-corrrcorrelate" id="toc-calculate-correlations-with-corrrcorrelate" class="nav-link" data-scroll-target="#calculate-correlations-with-corrrcorrelate">Calculate correlations with <code>corrr::correlate()</code></a></li>
  <li><a href="#use-tidyverse-verbs-on-correlates-output" id="toc-use-tidyverse-verbs-on-correlates-output" class="nav-link" data-scroll-target="#use-tidyverse-verbs-on-correlates-output">Use tidyverse verbs on <code>correlate()</code>’s output</a></li>
  <li><a href="#use-corrrs-formatting-functions" id="toc-use-corrrs-formatting-functions" class="nav-link" data-scroll-target="#use-corrrs-formatting-functions">Use <code>corrr</code>’s formatting functions</a></li>
  <li><a href="#visualize-correlations-with-the-corrr-package" id="toc-visualize-correlations-with-the-corrr-package" class="nav-link" data-scroll-target="#visualize-correlations-with-the-corrr-package">Visualize correlations with the <code>corrr</code> package</a></li>
  <li><a href="#wrap-up" id="toc-wrap-up" class="nav-link" data-scroll-target="#wrap-up">Wrap-up</a></li>
  <li><a href="#resources-to-learn-more" id="toc-resources-to-learn-more" class="nav-link" data-scroll-target="#resources-to-learn-more">Resources to learn more</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">TIL: Calculating correlations with <code>corrr</code></h1>
  <div class="quarto-categories">
    <div class="quarto-category">til</div>
    <div class="quarto-category">data analysis</div>
    <div class="quarto-category">exploratory analysis</div>
    <div class="quarto-category">data visualization</div>
  </div>
  </div>

<div>
  <div class="description">
    Use the corrr package to calculate and visualize correlations
  </div>
</div>


<div class="quarto-title-meta column-page-left">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Collin K. Berke, Ph.D. </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 22, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Today I learned calculating, visualising, and exploring correlations is easy with the <a href="https://corrr.tidymodels.org/index.html"><code>corrr package</code></a>.</p>
<p>In the past, I would rely on Base R’s <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/cor"><code>stats::cor()</code></a> for exploring correlations. This function is a powerful tool if you’re looking to do additional analysis beyond investigating correlation coefficients. <code>stats::cor()</code> has its <a href="https://drsimonj.svbtle.com/exploring-correlations-in-r-with-corrr">pain points</a>, though. Sometimes, I just want a package to explore correlations quickly and easily.</p>
<p>I recently stumbled across the <a href="https://corrr.tidymodels.org/index.html">corrr</a> package. It met all the needs I listed above. The purpose of this post is to highlight what I’ve learned while using this package, and to demonstrate functionality I’ve found useful. To get started, let’s attach some libraries and import some example data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="the-data" class="level1">
<h1>The data</h1>
<p>In this post, I explore correlations within <a href="https://bigten.org/sports/wvball">NCAA Big Ten Women’s volleyball</a> data. Living in Nebraska, you can’t but not enjoy the stellar play of Husker volleyball<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>; It’s also a very big deal around here<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. So, I saw it fitting to explore this data and take this opportunity to learn more about the game.</p>
<p>The data is aggregated match data from the 2021 season up to the middle of the 2023 season. Match data only includes Big Ten Conference teams. As of this writing, the data has been updated up to 2023-10-14.</p>
<p>Let’s import this data. <a href="https://readr.tidyverse.org/reference/read_delim.html"><code>readr::read_csv()</code></a> imports the data used in this post.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data_vball <span class="ot">&lt;-</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="fu">here</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"blog/posts/2023-10-22-til-correlations-with-corrr/2023_10_14_big10_vb_game_by_game.csv"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 14 Columns: 16
── Column specification ────────────────────────────────────────────────────────────────────────────
Delimiter: ","
chr  (1): team_name
dbl (15): wins, set_wins, set_loss, s, kills, errors, total_attacks, assists, aces, serr, digs, ...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>We can view the variables within the data by running <a href="https://dplyr.tidyverse.org/reference/glimpse.html"><code>dplyr::glimpse()</code></a> on <code>data_vball</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(data_vball)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 14
Columns: 16
$ team_name       &lt;chr&gt; "Illinois Fighting Illini", "Indiana Hoosiers", "Iowa Hawkeyes", "Maryland…
$ wins            &lt;dbl&gt; 7, 15, 8, 13, 12, 3, 7, 17, 9, 7, 13, 10, 9, 16
$ set_wins        &lt;dbl&gt; 29, 50, 31, 42, 43, 16, 29, 51, 35, 29, 41, 38, 34, 48
$ set_loss        &lt;dbl&gt; 36, 22, 41, 27, 28, 43, 30, 8, 30, 31, 20, 27, 29, 8
$ s               &lt;dbl&gt; 65, 72, 72, 69, 71, 59, 59, 59, 65, 60, 61, 65, 63, 56
$ kills           &lt;dbl&gt; 790, 948, 871, 877, 912, 674, 722, 816, 812, 743, 829, 834, 752, 779
$ errors          &lt;dbl&gt; 341, 352, 348, 355, 372, 350, 254, 270, 290, 327, 304, 296, 298, 197
$ total_attacks   &lt;dbl&gt; 2210, 2431, 2541, 2192, 2340, 2005, 1972, 1866, 2141, 2011, 2071, 2182, 20…
$ assists         &lt;dbl&gt; 705, 856, 801, 799, 829, 617, 668, 755, 737, 679, 755, 772, 690, 725
$ aces            &lt;dbl&gt; 86, 138, 116, 101, 112, 107, 84, 68, 83, 78, 59, 75, 83, 97
$ serr            &lt;dbl&gt; 153, 158, 124, 169, 209, 168, 157, 178, 126, 126, 123, 120, 144, 144
$ digs            &lt;dbl&gt; 867, 922, 1098, 855, 963, 812, 830, 782, 885, 839, 850, 905, 845, 803
$ block_solos     &lt;dbl&gt; 28, 57, 22, 27, 33, 25, 19, 20, 18, 27, 44, 29, 27, 22
$ block_assists   &lt;dbl&gt; 264, 248, 224, 321, 198, 159, 245, 268, 258, 167, 268, 248, 209, 272
$ avg_hit_pct     &lt;dbl&gt; 0.2036471, 0.2545238, 0.2027500, 0.2519474, 0.2431579, 0.1558824, 0.241600…
$ avg_opp_hit_pct &lt;dbl&gt; 0.2212353, 0.1578095, 0.2385500, 0.1834737, 0.1733684, 0.2615294, 0.177000…</code></pre>
</div>
</div>
<p>The data contains two types of statistics: counts and calculated metrics (e.g., average hitting percentage). Variable names should be informative. However, if you’re unfamilair with some of the terminology used within volleyball, here is a good <a href="https://en.wikipedia.org/wiki/Volleyball_jargon">list</a>.</p>
</section>
<section id="calculate-correlations-with-corrrcorrelate" class="level1">
<h1>Calculate correlations with <code>corrr::correlate()</code></h1>
<p>Obtaining a correlation table is easy with <code>corrr</code>. We just need to pipe our data to the <a href="https://corrr.tidymodels.org/reference/correlate.html"><code>correlate()</code></a> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>data_vball <span class="sc">|&gt;</span> <span class="fu">correlate</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Non-numeric variables removed from input: `team_name`
Correlation computed with
• Method: 'pearson'
• Missing treated using: 'pairwise.complete.obs'</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 16
   term         wins set_wins set_loss       s  kills errors total_attacks assists     aces     serr
   &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1 wins     NA         0.984    -0.902  0.0715  0.609 -0.322      -0.0912    0.651  0.00849  0.217  
 2 set_wins  0.984    NA        -0.859  0.183   0.692 -0.265       0.0128    0.729  0.0530   0.213  
 3 set_loss -0.902    -0.859    NA      0.346  -0.238  0.633       0.483    -0.292  0.276   -0.122  
 4 s         0.0715    0.183     0.346 NA       0.813  0.731       0.953     0.777  0.627    0.156  
 5 kills     0.609     0.692    -0.238  0.813  NA      0.394       0.711     0.993  0.450    0.187  
 6 errors   -0.322    -0.265     0.633  0.731   0.394 NA           0.727     0.324  0.470    0.283  
 7 total_a… -0.0912    0.0128    0.483  0.953   0.711  0.727      NA         0.673  0.636   -0.00449
 8 assists   0.651     0.729    -0.292  0.777   0.993  0.324       0.673    NA      0.430    0.173  
 9 aces      0.00849   0.0530    0.276  0.627   0.450  0.470       0.636     0.430 NA        0.366  
10 serr      0.217     0.213    -0.122  0.156   0.187  0.283      -0.00449   0.173  0.366   NA      
11 digs     -0.125    -0.0350    0.457  0.815   0.590  0.515       0.909     0.587  0.517   -0.137  
12 block_s…  0.324     0.366    -0.129  0.423   0.564  0.411       0.434     0.521  0.357    0.0474 
13 block_a…  0.617     0.595    -0.513  0.105   0.418 -0.300      -0.0276    0.429 -0.162   -0.0483 
14 avg_hit…  0.879     0.864    -0.934 -0.210   0.336 -0.680      -0.348     0.395 -0.223    0.0162 
15 avg_opp… -0.899    -0.873     0.927  0.180  -0.355  0.468       0.335    -0.396  0.150   -0.340  
# ℹ 5 more variables: digs &lt;dbl&gt;, block_solos &lt;dbl&gt;, block_assists &lt;dbl&gt;, avg_hit_pct &lt;dbl&gt;,
#   avg_opp_hit_pct &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Boom! Outputted is a correlation table of all our numeric variables within the dataset. <code>correlate()</code> was even smart enough to identify that <code>team_name</code> was of type character and excluded it for us.</p>
<p><code>correlate()</code> even informs us what’s happening under the hood: correlations were calculated using Pearson correlation and missing data (if we had any) were treated using the <code>pairwise.complete.obs</code> option. We can modify these options (e.g., use Spearman for correlation calculations) if needed. Check out the function’s documentation for more informtion (run <code>?correlate</code> in your R console).</p>
</section>
<section id="use-tidyverse-verbs-on-correlates-output" class="level1">
<h1>Use tidyverse verbs on <code>correlate()</code>’s output</h1>
<p><code>corrr</code> follows <a href="https://design.tidyverse.org/">tidy design principles</a>. One principle that is very useful is the <code>correlate()</code> function returns a standard object type, the <a href="https://tibble.tidyverse.org/">tibble</a>. Since a tibble is returned, <a href="https://www.tidyverse.org/">tidyverse</a> verbs can be used to further explore the correlation table. For instance, say we wanted to arrange correlations from highest to lowest for one of the columns. Wins seems like a good candidate here. We can do this by passing <code>correlate()</code>’s output to <a href="https://dplyr.tidyverse.org/reference/arrange.html"><code>dplyr::arrange()</code></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>data_vball <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">correlate</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(wins))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Non-numeric variables removed from input: `team_name`
Correlation computed with
• Method: 'pearson'
• Missing treated using: 'pairwise.complete.obs'</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 16
   term         wins set_wins set_loss       s  kills errors total_attacks assists     aces     serr
   &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1 set_wins  0.984    NA        -0.859  0.183   0.692 -0.265       0.0128    0.729  0.0530   0.213  
 2 avg_hit…  0.879     0.864    -0.934 -0.210   0.336 -0.680      -0.348     0.395 -0.223    0.0162 
 3 assists   0.651     0.729    -0.292  0.777   0.993  0.324       0.673    NA      0.430    0.173  
 4 block_a…  0.617     0.595    -0.513  0.105   0.418 -0.300      -0.0276    0.429 -0.162   -0.0483 
 5 kills     0.609     0.692    -0.238  0.813  NA      0.394       0.711     0.993  0.450    0.187  
 6 block_s…  0.324     0.366    -0.129  0.423   0.564  0.411       0.434     0.521  0.357    0.0474 
 7 serr      0.217     0.213    -0.122  0.156   0.187  0.283      -0.00449   0.173  0.366   NA      
 8 s         0.0715    0.183     0.346 NA       0.813  0.731       0.953     0.777  0.627    0.156  
 9 aces      0.00849   0.0530    0.276  0.627   0.450  0.470       0.636     0.430 NA        0.366  
10 total_a… -0.0912    0.0128    0.483  0.953   0.711  0.727      NA         0.673  0.636   -0.00449
11 digs     -0.125    -0.0350    0.457  0.815   0.590  0.515       0.909     0.587  0.517   -0.137  
12 errors   -0.322    -0.265     0.633  0.731   0.394 NA           0.727     0.324  0.470    0.283  
13 avg_opp… -0.899    -0.873     0.927  0.180  -0.355  0.468       0.335    -0.396  0.150   -0.340  
14 set_loss -0.902    -0.859    NA      0.346  -0.238  0.633       0.483    -0.292  0.276   -0.122  
15 wins     NA         0.984    -0.902  0.0715  0.609 -0.322      -0.0912    0.651  0.00849  0.217  
# ℹ 5 more variables: digs &lt;dbl&gt;, block_solos &lt;dbl&gt;, block_assists &lt;dbl&gt;, avg_hit_pct &lt;dbl&gt;,
#   avg_opp_hit_pct &lt;dbl&gt;</code></pre>
</div>
</div>
<p>This looks good, but does it really make sense to include the correlation between <code>set_wins</code>, <code>set_loss</code>, <code>s</code> (i.e., sets) with other variables in our data? Not really, so <code>corrr</code> provides the <a href="https://corrr.tidymodels.org/reference/focus.html"><code>focus()</code></a> function to remove columns and rows. We’ll also set the function’s <code>mirror</code> argument to <code>TRUE</code>, which will remove these variables from both the rows and columns of the output.</p>
<p>Let’s even go a bit further by using <code>focus()</code> to reduce the output down to only view variable correlations with wins. To do this, we use the following code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>data_vball <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">correlate</span>() <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">focus</span>(<span class="sc">-</span>set_wins, <span class="sc">-</span>set_loss, <span class="sc">-</span>s, <span class="at">mirror =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">focus</span>(wins) <span class="sc">|&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(wins))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Non-numeric variables removed from input: `team_name`
Correlation computed with
• Method: 'pearson'
• Missing treated using: 'pairwise.complete.obs'</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 2
   term                wins
   &lt;chr&gt;              &lt;dbl&gt;
 1 avg_hit_pct      0.879  
 2 assists          0.651  
 3 block_assists    0.617  
 4 kills            0.609  
 5 block_solos      0.324  
 6 serr             0.217  
 7 aces             0.00849
 8 total_attacks   -0.0912 
 9 digs            -0.125  
10 errors          -0.322  
11 avg_opp_hit_pct -0.899  </code></pre>
</div>
</div>
<p>Now we got something to learn more about the game. A few things of note:</p>
<ul>
<li><p>It seems we have evidence that hitting percentage and opponent hitting percentage play a sizeable role when it comes to wins. Although I’m not making a causal argument here, it makes sense from what I know about the game. If a team is efficient at scoring while also making their opponent less efficient (i.e., having a strong defense), you’ll be a pretty elite team in terms of wins.</p></li>
<li><p>Digs having a slight negative correlation is also surprising. One could argue that digs are important, especially in key situations. However, if your team is racking a significant amount each match, it might be an indication of deficienses in other areas of the defense (e.g., blocking).</p></li>
<li><p>The lack of correlation for aces is also surprising. You’d think more aces would be positively correlated with wins. I can’t come up with a reason why there’s little correlation here. Maybe some more exploratory analysis would reveal why this is the case.</p></li>
</ul>
<p>There’s some other results that might be worth further exploration. However, let’s get back to <code>corrr</code>’s features, as that’s the focus of this article.</p>
</section>
<section id="use-corrrs-formatting-functions" class="level1">
<h1>Use <code>corrr</code>’s formatting functions</h1>
<p>Back to our larger correlation coefficient table, say we want to only print out one part of the table. That is, say we want to get rid of either the upper or lower triangle to reduce the amount of information contained within the table. We can use <a href="https://corrr.tidymodels.org/reference/shave.html"><code>corrr::shave()</code></a> alongside <a href="https://corrr.tidymodels.org/reference/fashion.html"><code>corrr::fashion()</code></a> to do this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>data_vball <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">correlate</span>() <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">focus</span>(<span class="sc">-</span>set_wins, <span class="sc">-</span>set_loss, <span class="sc">-</span>s, <span class="at">mirror =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shave</span>() <span class="sc">|&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fashion</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Non-numeric variables removed from input: `team_name`
Correlation computed with
• Method: 'pearson'
• Missing treated using: 'pairwise.complete.obs'</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>              term wins kills errors total_attacks assists aces serr digs block_solos block_assists
1             wins                                                                                 
2            kills  .61                                                                            
3           errors -.32   .39                                                                      
4    total_attacks -.09   .71    .73                                                               
5          assists  .65   .99    .32           .67                                                 
6             aces  .01   .45    .47           .64     .43                                         
7             serr  .22   .19    .28          -.00     .17  .37                                    
8             digs -.13   .59    .51           .91     .59  .52 -.14                               
9      block_solos  .32   .56    .41           .43     .52  .36  .05  .17                          
10   block_assists  .62   .42   -.30          -.03     .43 -.16 -.05 -.12         .03              
11     avg_hit_pct  .88   .34   -.68          -.35     .39 -.22  .02 -.28         .03           .64
12 avg_opp_hit_pct -.90  -.35    .47           .33    -.40  .15 -.34  .35        -.22          -.52
   avg_hit_pct avg_opp_hit_pct
1                             
2                             
3                             
4                             
5                             
6                             
7                             
8                             
9                             
10                            
11                            
12        -.86                </code></pre>
</div>
</div>
<p>Now we have a correlation table that is pretty printed to the console with the upper triangle removed. You can remove the bottom triangle by setting <code>shave()</code>’s <code>upper</code> argument to <code>FALSE</code>. Although a table is great, sometimes a visualization conveys this information better.</p>
</section>
<section id="visualize-correlations-with-the-corrr-package" class="level1">
<h1>Visualize correlations with the <code>corrr</code> package</h1>
<p>Since <code>correlate()</code> outputs a tibble, it’s easy to create a visualization of values in the correlation table. We just have to pass the output to some <a href="https://ggplot2.tidyverse.org/"><code>ggplot2</code></a> code. Here we have a simple bar chart which arranges correlations with wins.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>data_vball <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">correlate</span>() <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">focus</span>(<span class="sc">-</span>set_wins, <span class="sc">-</span>set_loss, <span class="sc">-</span>s, <span class="at">mirror =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">focus</span>(wins) <span class="sc">|&gt;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">reorder</span>(term, wins)) <span class="sc">|&gt;</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(term, wins)) <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Non-numeric variables removed from input: `team_name`
Correlation computed with
• Method: 'pearson'
• Missing treated using: 'pairwise.complete.obs'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/vis-corr-wins-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><code>corrr</code> also provides the <a href="https://corrr.tidymodels.org/reference/network_plot.html"><code>network_plot()</code></a> plotting function, which provides an alternative way to visualize correlations. The function creates a network graph, where nodes represent variables, and the lightness and darkness of the colors represents the strength of the correlation between variables. To simplify the plot, the <code>min_cor</code> argument can be set to limit the minimum strength a correlation must be before it is included within the network plot. This is useful when you have many variables in a dataset that lack any correlation with one another, and you only want to visualize ones with the greatest positive and negative correlations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>data_vball <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">correlate</span>() <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">focus</span>(<span class="sc">-</span>set_wins, <span class="sc">-</span>set_loss, <span class="sc">-</span>s, <span class="at">mirror =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">network_plot</span>(<span class="at">min_cor =</span> <span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Non-numeric variables removed from input: `team_name`
Correlation computed with
• Method: 'pearson'
• Missing treated using: 'pairwise.complete.obs'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.
ℹ The deprecated feature was likely used in the corrr package.
  Please report the issue at &lt;https://github.com/tidymodels/corrr/issues&gt;.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/vis-network-wins-corr-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="wrap-up" class="level1">
<h1>Wrap-up</h1>
<p>In this post, I highlighted what I recently learned while using the <a href="https://corrr.tidymodels.org/index.html"><code>corrr</code> package</a>. To do this, I explored correlations within some <a href="https://bigten.org/sports/wvball">NCAA Big Ten Women’s volleyball</a> data. <code>corrr</code> makes it easy to explore correlations via the <a href="https://corrr.tidymodels.org/reference/correlate.html"><code>correlate()</code></a> function. Since <code>corrr</code> follows <a href="https://design.tidyverse.org/">tidy design principles</a>, its output of a <a href="https://tibble.tidyverse.org/">tibble</a> can be piped to other <a href="https://www.tidyverse.org/">tidyverse package</a> verbs to easily explore various correlations within our data. Finally, I covered how the output can be passed to <a href="https://ggplot2.tidyverse.org/"><code>ggplot2</code></a> plotting functions to visualize correlations. I then highlighted <code>corrr</code>’s built in <a href="https://corrr.tidymodels.org/reference/network_plot.html"><code>network_plot()</code></a> function as another tool to visualize correlations.</p>
<p>Have fun exploring your data with <code>corrr</code>!</p>
</section>
<section id="resources-to-learn-more" class="level1">
<h1>Resources to learn more</h1>
<ul>
<li><a href="https://drsimonj.svbtle.com/exploring-correlations-in-r-with-corrr">Exploring correlations in R with corrr</a></li>
</ul>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>As I was finishing this post, the <a href="https://huskers.com/sports/volleyball">Nebraska Women’s Volleyball team</a> <a href="https://bigten.org/boxscore.aspx?id=JcLFfL9RUu0H5ystoOMbjYgeW0QoC6K0726uwp87noWJWXu73Dn8TzTNTUhf17%2Fgd7i5ohZahns6d%2BruRwKgiVpITO5CN73jPmMstPwYhqft6f27jXQbUSRHbFwrkduosEgVmNZsiYvHbrEwAvjkPQ%3D%3D&amp;path=wvball">beat #1 Wisconsin</a> in a five set thriller.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The Nebraska Women’s Volleyball team <a href="https://huskers.com/volleyballday">broke the World Record for a women’s sporting event</a> on 2023-08-30. Official attendance was 92,003.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@misc{berke2023,
  author = {Berke, Collin K},
  title = {TIL: {Calculating} Correlations with `Corrr`},
  date = {2023-10-22},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-berke2023" class="csl-entry quarto-appendix-citeas" role="listitem">
Berke, Collin K. 2023. <span>“TIL: Calculating Correlations with
`Corrr`.”</span> October 22, 2023.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>